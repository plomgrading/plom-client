{% load static %}
<div class="card" style="min-width: fit-content; max-width: 50%">
  <div class="card-body d-flex flex-row p-0">
    {% if has_been_processed %}
    <img 
      src="{% url 'scan_get_image' timestamp 0 %}"
      class="border rounded-start"
      style="max-height: 14em;"
      >
    {% else %}
    <!-- display an animating loading thingy and refresh after a few seconds -->
    <img
      class="shadow-sm p-3 border rounded-start"
      src="{% static 'ball_triangle.svg' %}"
      style="max-height: 14em;"
      hx-get="{% url 'scan_get_staged_bundle_fragment' timestamp %}"
      hw-swap="innerHTML"
      hx-trigger="load delay:2s"
      hx-target="#bundle{{slug}}"
      >
    {% endif %}
    <div class="p-2">
      <h5 class="card-title">{{ slug }}.pdf</h5>
      <p class="card-subtitle">Uploaded {{ when }}</p>
      <ul class="list-unstyled">
        <li>Total pages: {{ number_of_pages }}
	  {% if has_been_processed %}
	  <i class="bi bi-check-circle text-success"></i>
	  {% else %}
	  <i class="bi bi-gear text-info"></i>
	  {% endif %}
	</li>
	{% if has_been_processed %}
	{% if has_qr_codes %}
        <li>Valid pages: {{ n_valid }}</li>
        <li>Error pages: {{ n_errors}}</li>
	{% else %}
	{% if is_mid_qr_read %}
	<li>Scanning QR - <img
	    class="shadow-sm p-3 border rounded-start"
	    src="{% static 'ball_triangle.svg' %}"
	    style="max-height: 4em;"
	    hx-get="{% url 'scan_get_staged_bundle_fragment' timestamp %}"
	    hw-swap="innerHTML"
	    hx-trigger="load delay:2s"
	    hx-target="#bundle{{slug}}"
	    >
	</li>
	{% else %}
	<li>QR codes not yet scanned</li>
	{% endif %}
	{% endif %}
	{% endif %}
      </ul>
      {% if has_been_processed %}
      <a 
        class="btn" 
        href="{% url 'scan_manage_bundle' timestamp 0 %}"
        style="background-color: #0F984F; color: white;"
        >
        View
      </a>
      {% if has_qr_codes or is_mid_qr_read %}
      {% else %}
      <button class="btn btn-info"
	      hx-post="{% url 'scan_get_staged_bundle_fragment' timestamp %}"
	      >Read QR</button>
      {% endif %}
	{% endif %}
      <a 
        class="btn btn-danger {% if bundle.disable_delete %}disabled{% endif %}" 
	hx-delete="{% url 'scan_get_staged_bundle_fragment' timestamp %}"
        hx-confirm="Are you sure?"
        >
        Remove
      </a>
    </div>
  </div>
</div>
