{% if in_progress %}
    {% if qr_results and task_status == 'error' %}
        <div>
            <p class="text-danger">{{ error }}</p>
            <p style="margin-bottom: 0px;">Parsed QR code:</p>
            <ul>
                <li>Test-paper {{ error_paper_id }}</li>
                <li>Page {{ error_page_num }}</li>
                <li>Version {{ error_version_num }}</li>
            </ul>
            <a 
                class="btn text-start"
                style="background-color: lightgrey;"
                data-bs-toggle="modal"
                data-bs-target="#errorPageChangeModal"
            >
            <i class="bi bi-file-earmark-check"></i>
            Set as valid page image
            </a><br><br>
            <!-- "Set as valid page image" Modal -->
            <div class="modal fade" id="errorPageChangeModal" tabindex="-1" aria-labelledby="errorPageChangeModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                    <h5 class="modal-title" id="errorPageChangeModalLabel">Are you sure you would like to change this error page to a valid page?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success" hx-post="{% url 'change_error_state' timestamp index %}">Save changes</button>
                    </div>
                </div>
                </div>
            </div>
            <a 
                class="btn btn-warning text-start"
                data-bs-toggle="modal"
                data-bs-target="#replacePageImageModal"
            >
            Replace page image
            </a><br><br>
            <!-- "Replace page image" Modal -->
            <div class="modal fade" id="replacePageImageModal" tabindex="-1" aria-labelledby="replacePageImageModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                    <h5 class="modal-title" id="replacePageImageModalLabel">Are you sure you would like to change this error page to a valid page?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        hello
                    </div>
                    <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-success" hx-post="#">Replace</button>
                    {% comment %} <button type="button" class="btn btn-success" hx-post="{% url 'replace_page_image' timestamp index %}">Replace</button> {% endcomment %}
                    </div>
                </div>
                </div>
            </div>
            <a class="btn btn-danger text-start w-100">Discard</a><br><br>
            {% if not flagged %}
                <form
                    enctype="multipart/form-data"
                    method="post"
                    action="{% url 'scan_flag_img' timestamp index %}"
                >
                {% csrf_token %}
                {{ form }}
        
                <input type="submit" class="btn" style="background-color: lightgrey; width: 100%" value="Flag to manager"> 
                </form>
            {% else %}
                <p>Paper flagged to manager <i class="bi bi-check-circle text-success"></i></p>
            {% endif %}
        </div>
    {% elif qr_results %}
        <div class="d-flex vstack gap-3">
            <h5 class="text-center">
                <i class="bi bi-check-circle text-success"></i>
                Page QR codes parsed
            </h5>
            <ul>
                <li>Test-paper {{ qr_results.paper_id }}</li>
                <li>Page {{ qr_results.page_num }}</li>
                <li>Version {{ qr_results.version_num }}</li>
            </ul>
        </div>
    {% else %}
        <div hx-get="{% url 'scan_qr_progress' timestamp index %}" hx-trigger="every 1s" hx-swap="outerHTML">
            <div class="d-flex justify-content-center">
            <div class="spinner-border"></div>
        </div>
    </div>
    {% endif %}
{% else %}
<div class="d-flex justify-content-center">
</div>
{% endif %}